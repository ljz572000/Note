# Redis 持久化

分为RDB（Redis Database ）（快照）和AOF(Append Only File)（只追加文件）.

生产中，一般都需要RDB和AOF同时开启，以确保最大程度上的持久化到所有的数据的变更。

RDB持久化有两种形式，save和bgsave.

RDB和AOF同时开启, 如果redis进行重启，优先加载AOF文件。AOF文件能够更加细粒度的控制我们redis他的一个数据周期，

# RDB

其实就是一个磁盘式的持久化。

RDB 持久化有两种形式，save 和 bgsave

save 模式目前来说，很少有企业使用。

因为save会造成，如果我当前的redis在执行save命令去生成我们的快照文件的话，对于其他redis 的请求，完全会被阻塞。拒绝掉。

bgsave 会从主线程中fork出一个子进程，进程中保存的是fork子进程时，redis主进程中的所有保存的数据，并以这个时间点的数据进行rdb文件的生成

正在进行bgsave,如果又来了一个save 操作，或者又来了一个bgsave操作。那么这个两个操作都会被拒绝掉，

因为 save 不能与bgsave 共存，bgsave 也不能与bgsave共存

正在进行bgsave,如果又来了一个write of AOF 操作, 这个时候redis 不会拒绝。但是你需要排队。先完成bgsave, 我再去重写你的AOF文件。

再去重写你的AOF文件，如果又来了一个bgsave, 会遭到拒绝。

> 如果在进行AOF的过程当中, 一定要选择我们业务需求不是非常多的情况下。
> 如果我们业务非常多，会触及redis 的save操作。
> 900秒1 ，300  10， 60 10000，

